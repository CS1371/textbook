<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019b"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: normal; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S1 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h3  class = 'S0'><span>Listing 6.2: Encryption</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>main</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    txt = [ </span><span style="color: rgb(160, 32, 240);">'The quality of mercy is not strain''d' </span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'original text: %s\n'</span><span>, txt);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    seed = 1234578;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    res = encrypt(txt, seed);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'encrypted text: %s\n'</span><span>, res);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    back = decrypt(res, seed, false);  </span><span style="color: rgb(60, 118, 61);">% decrypt with correct settings</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    good = </span><span style="color: rgb(160, 32, 240);">'matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>~strcmp(txt, back)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        good = </span><span style="color: rgb(160, 32, 240);">'not matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'decrypted text with right values: %s (%s)\n'</span><span>, back, good);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    back = decrypt(res, seed+1, false);  </span><span style="color: rgb(60, 118, 61);">% decrypt with bad seed</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    good = </span><span style="color: rgb(160, 32, 240);">'matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>~strcmp(txt, back)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        good = </span><span style="color: rgb(160, 32, 240);">'not matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'decrypted text with bad seed: %s (%s)\n'</span><span>, back, good);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    back = decrypt(res, seed, true);  </span><span style="color: rgb(60, 118, 61);">% decrypt with bad generator</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    good = </span><span style="color: rgb(160, 32, 240);">'matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>~strcmp(txt, back)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        good = </span><span style="color: rgb(160, 32, 240);">'not matched'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'decrypted text with bad generator: %s (%s)\n'</span><span>, back, good);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'></div></div></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>res = encrypt(txt, seed)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% encrypt txt with the 'twister' generator and the given seed</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% usage: function res = encrypt(txt, seed)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">%   txt: text to encrypt</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">%  seed: seed value for the generator</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    rng(seed, </span><span style="color: rgb(160, 32, 240);">'twister'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% solve the wrap-around cases </span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% set wraparound bounds and range</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    loch = 33; hich = 126; range = hich+1-loch;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% generate random integer array with length of text</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">%  and values 0 .. range - 1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    rn = floor( range * rand(1, length(txt) ) );</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% only change the letters within legal bounds</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    change = (txt&gt;=loch) &amp; (txt&lt;=hich);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% make a copy of txt</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    enc = txt;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% add random num to legal characters</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    enc(change) = enc(change) + rn(change);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% since this is addition, can't go below loch</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% wrap encrypted values off to the right </span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    enc(enc &gt; hich) = enc(enc &gt; hich) - range;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% return the result</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    res = char(enc);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>res = decrypt(txt, seed, change_gen)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% decrypt txt with the given seed, maybe change the generator</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% usage: function res = decrypt(txt, seed, change_gen)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">%        txt: text to encrypt</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">%       seed: seed value for the generator</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% change_gen: logical - if true, change the generator</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>change_gen</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        rng(seed, </span><span style="color: rgb(160, 32, 240);">'v4'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        rng(seed, </span><span style="color: rgb(160, 32, 240);">'twister'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% solve the wrap-around cases </span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% set wraparound bounds and range</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    loch = 33; hich = 126; range = hich+1-loch;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% generate random integer array with length of text</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">%  and values 0 .. range - 1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    rn = floor( range * rand(1, length(txt) ) );</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% only change the letters within legal bounds</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    change = (txt&gt;=loch) &amp; (txt&lt;=hich);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% make a copy of txt</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    dec = txt;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% since this is subtraction, can't go above hich</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% however, must wrap decrypted values off to the left</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">%  because they could have negative indices</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    dec(change) = dec(change) - rn(change) + range;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% then wrap the characters we just moved beyond hich</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    dec(dec &gt; hich) = dec(dec &gt; hich) - range;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(60, 118, 61);">% return the result</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    res = char(dec);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
function main
% Listing 6.2: Encryption
    txt = [ 'The quality of mercy is not strain''d' ];
    fprintf('original text: %s\n', txt);
    seed = 1234578;
    res = encrypt(txt, seed);
    fprintf('encrypted text: %s\n', res);
    back = decrypt(res, seed, false);  % decrypt with correct settings
    good = 'matched';
    if ~strcmp(txt, back)
        good = 'not matched';
    end
    fprintf('decrypted text with right values: %s (%s)\n', back, good);
    back = decrypt(res, seed+1, false);  % decrypt with bad seed
    good = 'matched';
    if ~strcmp(txt, back)
        good = 'not matched';
    end
    fprintf('decrypted text with bad seed: %s (%s)\n', back, good);
    back = decrypt(res, seed, true);  % decrypt with bad generator
    good = 'matched';
    if ~strcmp(txt, back)
        good = 'not matched';
    end
    fprintf('decrypted text with bad generator: %s (%s)\n', back, good);
end
%%
function res = encrypt(txt, seed)
% encrypt txt with the 'twister' generator and the given seed
% usage: function res = encrypt(txt, seed)
%   txt: text to encrypt
%  seed: seed value for the generator
    rng(seed, 'twister')
% solve the wrap-around cases 
    % set wraparound bounds and range
    loch = 33; hich = 126; range = hich+1-loch;
    % generate random integer array with length of text
    %  and values 0 .. range - 1
    rn = floor( range * rand(1, length(txt) ) );
    % only change the letters within legal bounds
    change = (txt>=loch) & (txt<=hich);
    % make a copy of txt
    enc = txt;
    % add random num to legal characters
    enc(change) = enc(change) + rn(change);
    % since this is addition, can't go below loch
    % wrap encrypted values off to the right 
    enc(enc > hich) = enc(enc > hich) - range;
    % return the result
    res = char(enc);
end
function res = decrypt(txt, seed, change_gen)
% decrypt txt with the given seed, maybe change the generator
% usage: function res = decrypt(txt, seed, change_gen)
%        txt: text to encrypt
%       seed: seed value for the generator
% change_gen: logical - if true, change the generator
    if change_gen
        rng(seed, 'v4');
    else
        rng(seed, 'twister');
    end
% solve the wrap-around cases 
    % set wraparound bounds and range
    loch = 33; hich = 126; range = hich+1-loch;
    % generate random integer array with length of text
    %  and values 0 .. range - 1
    rn = floor( range * rand(1, length(txt) ) );
    % only change the letters within legal bounds
    change = (txt>=loch) & (txt<=hich);
    % make a copy of txt
    dec = txt;
    % since this is subtraction, can't go above hich
    % however, must wrap decrypted values off to the left
    %  because they could have negative indices
    dec(change) = dec(change) - rn(change) + range;
    % then wrap the characters we just moved beyond hich
    dec(dec > hich) = dec(dec > hich) - range;
    % return the result
    res = char(dec);
end
##### SOURCE END #####
--></body></html>