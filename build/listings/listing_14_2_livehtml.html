<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019b"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: normal; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S1 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h3  class = 'S0'><span>Listing 14.2: Playing the piano</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% Playing the piano</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>main</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    [note Fs] = audioread(</span><span style="color: rgb(160, 32, 240);">'../Text/instr_piano.wav'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    N = length(note);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    half_note = 2.^(1/12);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'middle C on the piano\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note, Fs);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(length(note) ./ Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'octave higher by doubling the playback frequency\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note, Fs*2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(length(note) ./ (2*Fs))</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'octave lower by stretching the sound vector\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note(round(1:0.5:end)), Fs);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(length(note) ./ (0.5*Fs))</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'middle C on the piano\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    seconds = 0.5; </span><span style="color: rgb(60, 118, 61);">% length(note) / Fs</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    mult = half_note;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'play an octave of black and white notes\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>count = 1:12</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sound(note, Fs*mult)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        mult = mult * half_note;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'play C major scale by changing frequency\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    gaps = [2 2 1 2 2 2 1];</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    mult = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>count = 1:length(gaps)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        times = gaps(count);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        mult = mult * (half_note .^ times);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sound(note, Fs*mult)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'play C major scale by shrinking the sound vector\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    mult = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(note, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>count = 1:length(gaps)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        times = gaps(count);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        mult = mult * (half_note .^ times);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        ndx = round(linspace(1,N,N/mult));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sound(note(ndx), Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        pause(seconds)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>	play_steps(note)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    run(</span><span style="color: rgb(160, 32, 240);">'../Text/ramblinWreck'</span><span>)   </span><span style="color: rgb(60, 118, 61);">% fetch the score</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'play a tune using music notation for pitch\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    solo = play_part(soloPart,</span><span style="color: rgb(160, 32, 240);">'organ'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    t = 0.75 * length(solo) ./ Fs;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(solo, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(t)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'assemble orchestra parts\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    solo = play_part(soloPart, </span><span style="color: rgb(160, 32, 240);">'tpt'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    solomax = max(abs(solo));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NSolo = length(solo);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    soprano = play_part(sopranoPart, </span><span style="color: rgb(160, 32, 240);">'piano'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sopmax = max(abs(soprano));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NSop = length(soprano);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    alto1 = play_part(alto1Part, </span><span style="color: rgb(160, 32, 240);">'piano'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    alto1max = max(abs(alto1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NA1 = length(alto1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    alto2 = play_part(alto2Part, </span><span style="color: rgb(160, 32, 240);">'piano'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    alto2max = max(abs(alto2));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NA2 = length(alto2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    tenor = play_part(tenorPart, </span><span style="color: rgb(160, 32, 240);">'organ'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    tenormax = max(abs(tenor));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NT = length(tenor);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    bass = play_part(bassPart, </span><span style="color: rgb(160, 32, 240);">'tbone'</span><span>, 180);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    bassmax = max(abs(bass));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NB = length(bass);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    RSize = max([NSop NA1 NA2 NT NB]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right = zeros(RSize, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    LSize = max([NSolo, NB]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    left = zeros(LSize, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NRight = 5;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    NLeft = 8;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right(1:NSop) = right(1:NSop) + soprano ./ NRight;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right(1:NA1) = right(1:NA1) + alto1 ./ NRight;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right(1:NA2) = right(1:NA2) + alto2 ./ NRight;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right(1:NT) = right(1:NT) + tenor ./ NRight;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    right(1:NB) = right(1:NB) + bass ./ NRight;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    left(1:NSolo) = left(1:NSolo) + solo * 1.5 ./ NLeft;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    left(1:NB) = left(1:NB) + bass * 3 ./ NLeft;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    wreck(1:RSize,1) = right;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    wreck(1:LSize,2) = left;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    keep = (right ~= 0) | (left ~= 0);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>	wreck = wreck(keep);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sound(wreck, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pause(length(wreck)./Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    audiowrite(</span><span style="color: rgb(160, 32, 240);">'new_wreck.wav'</span><span>, wreck, Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'></div></div></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>play_steps(note)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>	</span><span style="color: rgb(0, 0, 255);">global </span><span>Fs</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    half_note = 2.^(1/12);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    N = length(note)/10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">'play a tune using half_step count for pitch\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    notes = [   4  2</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        2  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  2</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  2</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        2  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        4  2</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        4  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        4  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        2  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        2  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        4  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        2  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  2</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        -1  1</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        0  4];</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>ndx = 1:length(notes)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        nt = notes(ndx, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        dur = notes(ndx, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        mult = half_note .^ nt;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sampler = floor(linspace(1, N, N / mult));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sound(note(sampler), Fs)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        pause(0.2*dur)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>part = play_part( score, instr, rate)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">global </span><span>Fs;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    fname = [</span><span style="color: rgb(160, 32, 240);">'../Text/instr_' </span><span>instr </span><span style="color: rgb(160, 32, 240);">'.wav'</span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    [note Fs] = audioread(fname);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    note = [note; zeros(200000,1)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    lngth = overall(score);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    Ns = length(note);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    maxSize = Ns + Fs * lngth * 60 / rate;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    part = zeros(maxSize,1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    dt = 60/rate;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    where = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    samples = Fs * dt;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>ndx = 1:length(score)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        name = score{ndx, 1};</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        dur = score{ndx, 2};</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        pitch = getPitch(name);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        num = samples * dur;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>~strcmp(name, </span><span style="color: rgb(160, 32, 240);">'R0'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            index = ceil(linspace(1, Ns, Ns/pitch));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            notes = note(index(1:num));</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            part(where:(where+num-1)) = part(where:(where+num-1))  + notes;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        where = where + num;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>sum = overall(score)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    sum = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    N = length(score);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>it = 1:N</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        sum = sum + score{it,2};</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">function </span><span>[pitch, muted] = getPitch(note)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span style="color: rgb(60, 118, 61);">% Get the pitch of a note in ascii form</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    half = 2.^(1/12);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    muted = false;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">switch </span><span>note(1:end-1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'C'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'R'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            muted = true;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'CS' 'DF'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'D'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'DS' 'EF'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 3;        </span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'E'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'F'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 5;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'FS' 'GF'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 6;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'G'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 7;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'GS' 'AF'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 8;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'A'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 9;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span>{</span><span style="color: rgb(160, 32, 240);">'AS' 'BF'</span><span>}</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">case </span><span style="color: rgb(160, 32, 240);">'B'</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            power = 11;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>        </span><span style="color: rgb(0, 0, 255);">otherwise</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>            error([</span><span style="color: rgb(160, 32, 240);">'bad note value: ' </span><span>note])</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    let = note(end) - </span><span style="color: rgb(160, 32, 240);">'0'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    diff = let - 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    power = power + 12 * diff;</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: normal;"><span>    pitch = half .^ power;</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: normal;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
% Listing 14.2: Playing the piano

% Playing the piano
function main
    [note Fs] = audioread('../Text/instr_piano.wav');
    N = length(note);
    half_note = 2.^(1/12);
    fprintf('middle C on the piano\n')
    sound(note, Fs);
    pause(length(note) ./ Fs)
    fprintf('octave higher by doubling the playback frequency\n')
    sound(note, Fs*2);
    pause(length(note) ./ (2*Fs))
    fprintf('octave lower by stretching the sound vector\n')
    sound(note(round(1:0.5:end)), Fs);
    pause(length(note) ./ (0.5*Fs))
    fprintf('middle C on the piano\n')
    sound(note, Fs)
    seconds = 0.5; % length(note) / Fs
    pause(seconds)
    mult = half_note;
    fprintf('play an octave of black and white notes\n')
    for count = 1:12
        sound(note, Fs*mult)
        pause(seconds)
        mult = mult * half_note;
    end
    fprintf('play C major scale by changing frequency\n')
    gaps = [2 2 1 2 2 2 1];
    mult = 1;
    sound(note, Fs)
    pause(seconds)
    for count = 1:length(gaps)
        times = gaps(count);
        mult = mult * (half_note .^ times);
        sound(note, Fs*mult)
        pause(seconds)
    end
    fprintf('play C major scale by shrinking the sound vector\n')
    mult = 1;
    sound(note, Fs)
    pause(seconds)
    for count = 1:length(gaps)
        times = gaps(count);
        mult = mult * (half_note .^ times);
        ndx = round(linspace(1,N,N/mult));
        sound(note(ndx), Fs)
        pause(seconds)
    end
	play_steps(note)
    run('../Text/ramblinWreck')   % fetch the score
    fprintf('play a tune using music notation for pitch\n')
    solo = play_part(soloPart,'organ', 180);
    t = 0.75 * length(solo) ./ Fs;
    sound(solo, Fs)
    pause(t)
    fprintf('assemble orchestra parts\n')
    solo = play_part(soloPart, 'tpt', 180);
    solomax = max(abs(solo));
    NSolo = length(solo);
    soprano = play_part(sopranoPart, 'piano', 180);
    sopmax = max(abs(soprano));
    NSop = length(soprano);
    alto1 = play_part(alto1Part, 'piano', 180);
    alto1max = max(abs(alto1));
    NA1 = length(alto1);
    alto2 = play_part(alto2Part, 'piano', 180);
    alto2max = max(abs(alto2));
    NA2 = length(alto2);
    tenor = play_part(tenorPart, 'organ', 180);
    tenormax = max(abs(tenor));
    NT = length(tenor);
    bass = play_part(bassPart, 'tbone', 180);
    bassmax = max(abs(bass));
    NB = length(bass);
    RSize = max([NSop NA1 NA2 NT NB]);
    right = zeros(RSize, 1);
    LSize = max([NSolo, NB]);
    left = zeros(LSize, 1);
    NRight = 5;
    NLeft = 8;
    right(1:NSop) = right(1:NSop) + soprano ./ NRight;
    right(1:NA1) = right(1:NA1) + alto1 ./ NRight;
    right(1:NA2) = right(1:NA2) + alto2 ./ NRight;
    right(1:NT) = right(1:NT) + tenor ./ NRight;
    right(1:NB) = right(1:NB) + bass ./ NRight;
    left(1:NSolo) = left(1:NSolo) + solo * 1.5 ./ NLeft;
    left(1:NB) = left(1:NB) + bass * 3 ./ NLeft;
    wreck(1:RSize,1) = right;
    wreck(1:LSize,2) = left;
    keep = (right ~= 0) | (left ~= 0);
	wreck = wreck(keep);
    sound(wreck, Fs)
    pause(length(wreck)./Fs)
    audiowrite('new_wreck.wav', wreck, Fs)
end

%%
function play_steps(note)
	global Fs
    half_note = 2.^(1/12);
    N = length(note)/10;
    fprintf('play a tune using half_step count for pitch\n')
    notes = [   4  2
        2  1
        0  2
        0  1
        0  2
        2  1
        4  2
        4  1
        4  1
        2  1
        0  1
        2  1
        4  1
        2  1
        0  2
        -1  1
        0  4];
    for ndx = 1:length(notes)
        nt = notes(ndx, 1);
        dur = notes(ndx, 2);
        mult = half_note .^ nt;
        sampler = floor(linspace(1, N, N / mult));
        sound(note(sampler), Fs)
        pause(0.2*dur)
    end
end
function part = play_part( score, instr, rate)
    global Fs;
    fname = ['../Text/instr_' instr '.wav'];
    [note Fs] = audioread(fname);
    note = [note; zeros(200000,1)];
    lngth = overall(score);
    Ns = length(note);
    maxSize = Ns + Fs * lngth * 60 / rate;
    part = zeros(maxSize,1);
    dt = 60/rate;
    where = 1;
    samples = Fs * dt;
    for ndx = 1:length(score)
        name = score{ndx, 1};
        dur = score{ndx, 2};
        pitch = getPitch(name);
        num = samples * dur;
        if ~strcmp(name, 'R0')
            index = ceil(linspace(1, Ns, Ns/pitch));
            notes = note(index(1:num));
            part(where:(where+num-1)) = part(where:(where+num-1))  + notes;
        end
        where = where + num;
    end
end
function sum = overall(score)
    sum = 0;
    N = length(score);
    for it = 1:N
        sum = sum + score{it,2};
    end
end
function [pitch, muted] = getPitch(note)
% Get the pitch of a note in ascii form
    half = 2.^(1/12);
    muted = false;
    switch note(1:end-1)
        case {'C'}
            power = 0;
        case {'R'}
            power = 0;
            muted = true;
        case {'CS' 'DF'}
            power = 1;
        case 'D'
            power = 2;
        case {'DS' 'EF'}
            power = 3;        
        case 'E'
            power = 4;
        case 'F'
            power = 5;
        case {'FS' 'GF'}
            power = 6;
        case 'G'
            power = 7;
        case {'GS' 'AF'}
            power = 8;
        case 'A'
            power = 9;
        case {'AS' 'BF'}
            power = 10;
        case 'B'
            power = 11;
        otherwise
            error(['bad note value: ' note])
    end
    let = note(end) - '0';
    diff = let - 4;
    power = power + 12 * diff;
    pitch = half .^ power;
end
##### SOURCE END #####
--></body></html>